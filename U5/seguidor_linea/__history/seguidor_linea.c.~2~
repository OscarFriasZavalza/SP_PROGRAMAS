/* Main.c file generated by New Project wizard
 *
 * Created:   jue. ene. 27 2022
 * Processor: PIC16F84A
 * Compiler:  CCS for PIC
 */

#include <16F84A.h>
#fuses XT, NOWDT
#use delay(clock = 4000000)
#use fast_io(B) //configuramos los TRIS solo una vez, es la forma mas rápida de trabajar con los puertos
#use fast_io(A)

int pot_izq = 0; //potencia del motor izquierdo
int pot_der = 0; //potencia del motor derecho
int k_cerradas = 20; //constante para curvas cerradas (0-255) 0 es curva muy cerrada 255 es una recta --- >20
int k = 230; //constante para giro leve --->230

void frente (void) //ambos motores al máximo de potencia
{
   pot_izq = 255;
   pot_der = 255;
}
void izquierda (void) //la potencia del motor derecho es mayor a la del izquierdo
{
   pot_izq = k;
   pot_der = 255;
}

void izquierda_cerrada (void)
{
   pot_izq = k_cerradas;
   pot_der = 255;
}

void derecha (void)
{
   pot_izq = 255;
   pot_der = k;
}

void derecha_cerrada(void)
{
   pot_izq = 255;
   pot_der = k_cerradas;
}
void main (void)
 { 
   int sensores = 0b000;
   set_tris_B(0x00); //puero B como salidas
   set_tris_A(0xFF); //puerto A como entradas digitales
   OUTPUT_B(0); //inicializamos en 0 el puerto B
   //dirrección de los motores hacia adelante
   output_high(PIN_B0);
   output_low(PIN_B1);
   output_high(PIN_B3);
   output_low(PIN_B4);

while (1)
      {
         sensores = input_A(); //lectura de los sensores en el puerto A

         if(sensores == 0b001)
         derecha_cerrada();
         if(sensores == 0b011)
         derecha();
         if(sensores == 0b100)
         izquierda_cerrada();
         if(sensores == 0b110)
         izquierda();

         output_high(PIN_B2);
         delay_us(pot_izq);

         output_low(PIN_B2);
         delay_us(255 - pot_izq);

         output_high(PIN_B5);
         delay_us(pot_der);

         output_low(PIN_B5);
         delay_us(255 - pot_der);

      }
         
 }   
